{% docs __overview__ %}
# Amplitude Analytics Silver Layer

This dbt project transforms raw Amplitude event data (JSON) into analytics-ready dimensional tables.

## Architecture
- **Staging Layer**: Parses JSON into typed columns (1:1 with source)
- **Intermediate Layer**: 6 dimensional/fact tables in the silver schema

## Key Features
- Surrogate keys generated using `dbt_utils.generate_surrogate_key()`
- Incremental models for events and sessions
- Comprehensive data quality testing
- Deduplication by UUID in events table

For more details, see the [project README](https://github.com/your-org/amplitude).
{% enddocs %}

<!-- Core Identifiers -->

{% docs amplitude_id %}
Amplitude's internal user identifier. This is the primary key for users and persists across sessions and devices.
{% enddocs %}

{% docs user_id %}
User identifier, typically an email address or custom user ID from your application.
{% enddocs %}

{% docs device_id %}
Unique identifier for the device used to generate the event.
{% enddocs %}

{% docs uuid %}
Unique event identifier generated by Amplitude. Used as the basis for event_id surrogate key.
{% enddocs %}

{% docs event_id_raw %}
Raw event ID from Amplitude (numeric). Not guaranteed to be unique.
{% enddocs %}

{% docs session_id_raw %}
Raw session ID from Amplitude (numeric). Multiple events share the same session ID.
{% enddocs %}

<!-- Surrogate Keys -->

{% docs surrogate_key_methodology %}
Surrogate keys in this project are generated using `dbt_utils.generate_surrogate_key()` which creates MD5 hashes of the input fields. This ensures consistent, deterministic keys across runs.
{% enddocs %}

{% docs event_id %}
Surrogate key generated from UUID. This is the primary key for the events table and is guaranteed to be unique after deduplication.
{% enddocs %}

{% docs session_id %}
Surrogate key generated from `session_id_raw || amplitude_id`. Uniquely identifies a user session.
{% enddocs %}

{% docs ip_address_id %}
Surrogate key generated from IP address. Links to the ip_addresses dimension table.
{% enddocs %}

{% docs event_properties_id %}
Surrogate key generated from the full event properties JSON object. Links to the event_properties dimension table.
{% enddocs %}

{% docs user_properties_id %}
Surrogate key generated from the full user properties JSON object. Captures the state of user properties at the time of the event.
{% enddocs %}

{% docs company_id %}
Surrogate key generated from `company || ip_address`. Uniquely identifies a company-IP combination.
{% enddocs %}

{% docs location_id %}
Surrogate key generated from `city || region || country`. Identifies geographic location of the event.
{% enddocs %}

<!-- Timestamps -->

{% docs event_time %}
Timestamp when the event occurred (in UTC). This is the primary timestamp used for incremental model filtering.
{% enddocs %}

{% docs client_event_time %}
Timestamp when the event was generated on the client device. May differ from event_time due to clock skew.
{% enddocs %}

{% docs server_received_time %}
Timestamp when Amplitude's servers received the event.
{% enddocs %}

{% docs last_seen %}
Timestamp of the most recent event for a given user. Updated with each new event.
{% enddocs %}

{% docs session_start %}
Timestamp of the first event in a session.
{% enddocs %}

{% docs session_end %}
Timestamp of the last event in a session.
{% enddocs %}

<!-- Event Data -->

{% docs event_type %}
Type of event (e.g., "page_view", "session_start", "button_click"). This is a required field from Amplitude.
{% enddocs %}

{% docs event_properties %}
JSON/VARIANT column containing all event-level properties (page URL, referrer, clicked element, etc.).
{% enddocs %}

{% docs user_properties %}
JSON/VARIANT column containing all user-level properties (plan type, account status, preferences, etc.).
{% enddocs %}

<!-- Geographic Data -->

{% docs ip_address %}
IP address from which the event originated. Used for geolocation and company identification.
{% enddocs %}

{% docs city %}
City name derived from IP geolocation.
{% enddocs %}

{% docs region %}
Region/state derived from IP geolocation.
{% enddocs %}

{% docs country %}
Country name derived from IP geolocation.
{% enddocs %}

<!-- Device & Platform -->

{% docs platform %}
Platform generating the event (Web, iOS, Android, etc.).
{% enddocs %}

{% docs os_name %}
Operating system name (e.g., "Mac OS X", "Windows", "iOS").
{% enddocs %}

{% docs os_version %}
Operating system version number.
{% enddocs %}

{% docs device_type %}
Device type category (e.g., "Mac", "Windows", "Mobile", "Tablet").
{% enddocs %}

{% docs device_family %}
Device family/model (e.g., "iPhone", "MacBook").
{% enddocs %}

<!-- Session Aggregates -->

{% docs event_count %}
Number of events in the session. Calculated by counting all events with the same session_id.
{% enddocs %}

{% docs user_journey %}
Concatenated page paths showing user navigation flow through the session. Pages are separated by " > " and ordered chronologically.
{% enddocs %}

<!-- Event Properties Fields -->

{% docs url %}
Page URL extracted from event properties `[Amplitude] Page URL`. Truncated to 1000 characters.
{% enddocs %}

{% docs referrer %}
Referrer URL showing where the user came from. Truncated to 1000 characters.
{% enddocs %}

{% docs referring_domain %}
Domain extracted from the referrer URL. Truncated to 255 characters.
{% enddocs %}

{% docs element_text %}
Text content of the clicked element (for click events). Truncated to 500 characters.
{% enddocs %}

{% docs page_title %}
Browser page title. Truncated to 500 characters.
{% enddocs %}

{% docs properties_json %}
Full event properties stored as VARIANT/JSON. This is the source for all extracted event property fields.
{% enddocs %}

<!-- Company Fields -->

{% docs company %}
Company domain extracted from email address (the part after @). Consumer email providers (gmail.com, yahoo.com, etc.) are filtered out.
{% enddocs %}

{% docs company_name %}
Denormalized company name stored in the events table for query performance. Populated from the users.company field.
{% enddocs %}

<!-- Data Quality Notes -->

{% docs deduplication_note %}
This model deduplicates events by UUID using a ROW_NUMBER() window function, keeping the most recent record by event_time. Duplicate UUIDs can occur due to data reprocessing or SDK retry logic.
{% enddocs %}

{% docs incremental_strategy %}
This model uses incremental materialization to improve performance. On incremental runs, it only processes events with `event_time > max(event_time)` from the existing table. Use `dbt run --full-refresh` to rebuild from scratch.
{% enddocs %}
